---
name: ww-chat-ai
description: ChatGPT-style AI chat interface with role-based messaging (user/assistant), streaming support, attachments, and date separators.
keywords: [chat, ai, assistant, chatgpt, openai, streaming, conversation, attachments]
---

#### ww-chat-ai

***Purpose:***
AI-focused chat UI with ChatGPT-style design: transparent assistant messages, user message bubbles, role-based system (user/assistant), real-time streaming support for OpenAI-style responses, optional attachments for vision/document AI models, and date separators.

***Properties:***

**Chat Settings:**
- userLabel: string – Label for user messages. Example: 'You'
- assistantLabel: string – Label for AI assistant messages. Example: 'Assistant'
- disabled: boolean – Disable input/actions. Example: false
- enableMarkdown: boolean – Enable markdown rendering with syntax highlighting. When false, uses white-space: pre-line to respect \n. Example: false
- autoScrollBehavior: 'auto'|'smooth' – Scroll mode for new messages. Example: 'auto'

**Attachment Settings:**
- allowAttachments: boolean – Enable file attachments (for vision models, document analysis). Example: false
- attachmentMode: 'single'|'multiple' – Allow single file or multiple files per upload. Example: 'multiple'
- allowedAttachmentTypes: string – Comma-separated MIME types or extensions to allow. Supports wildcards (image/*), MIME types (image/png), and extensions (.pdf). Empty = all types allowed. Example: 'image/*,.pdf'
- attachmentErrorMessage: string – Custom error message for rejected files. Template variables: {files} (rejected file names), {types} (allowed types). Example: '⚠️ {files} cannot be uploaded. Allowed: {types}'

**Chat Data:**
- messages: array – Conversation data with role-based messages. Example: [{ content: 'Hello', role: 'user', timestamp: '2025-01-15T10:30:00Z' }]
- mappingMessageId: Formula – Extract unique message ID. Default: context.mapping?.['id']
- mappingMessageText: Formula – Extract message content text. Default: context.mapping?.['content']
- mappingRole: Formula – Extract message role ('user' or 'assistant'). Default: context.mapping?.['role']
- mappingTimestamp: Formula – Extract timestamp. Default: context.mapping?.['timestamp']
- mappingAttachments: Formula – Extract attachments array from message. Default: context.mapping?.['attachments']
- mappingAttachmentId: Formula – Extract attachment ID field. Default: context.mapping?.['id']
- mappingAttachmentName: Formula – Extract attachment name field. Default: context.mapping?.['name']
- mappingAttachmentUrl: Formula – Extract attachment URL field. Default: context.mapping?.['url']
- mappingAttachmentType: Formula – Extract attachment MIME type. Default: context.mapping?.['type']
- mappingAttachmentSize: Formula – Extract attachment size in bytes. Default: context.mapping?.['size']
- mappingAttachmentPath: Formula – Extract attachment file path/location (e.g., Supabase bucket path). Default: context.mapping?.['path']

**Localization & Dates:**
- locale: 'enUS'|'fr'|'de'|'es'|'ja'|'zh'|'ko'|... – Language for date/time formatting. Supports 50+ languages including English, French, German, Spanish, Italian, Portuguese, Russian, Chinese, Japanese, Korean, Arabic, Hindi, Bengali, Dutch, Swedish, Norwegian, Danish, Finnish, Greek, Turkish, Czech, Polish, Romanian, Hungarian, Vietnamese, Thai, Indonesian, Malay, Ukrainian. Example: 'enUS'
- todayText: string – Custom text for today's messages. Example: 'Today' (French: 'Aujourd\'hui')
- yesterdayText: string – Custom text for yesterday's messages. Example: 'Yesterday' (French: 'Hier')
- justNowText: string – Custom text for very recent messages. Example: 'just now' (French: 'à l\'instant')
- timeFormat: 'h:mm a'|'HH:mm'|'h:mm:ss a'|'HH:mm:ss' – Time format for message timestamps. Example: 'h:mm a' (12-hour), 'HH:mm' (24-hour)

**Streaming (Critical for AI Response Display):**
- isStreaming: boolean – **REQUIRED** Set to true while AI is generating response, false when complete. Controls visibility of streaming message bubble. Example: false
- streamingText: string|string[] – **REQUIRED** The actual streaming content being generated by AI. Bind this to your OpenAI/Claude streaming variable. Supports string or array (uses first element if array). Automatically updates UI as AI generates tokens. Example: 'The answer is...'

**IMPORTANT STREAMING WORKFLOW:**
1. User sends message → `messageSent` event fires
2. Set `isStreaming = true` BEFORE starting API call
3. Bind `streamingText` to your streaming variable (e.g., from OpenAI plugin with stream:true)
4. As AI generates tokens, `streamingText` updates automatically and displays in a temporary assistant message bubble
5. When streaming completes, set `isStreaming = false`
6. Add final message with full `content` to the `messages` array
7. Component automatically scrolls and clears streaming bubble when `isStreaming` becomes false

**Common Streaming Pattern:**
On messageSent event:
1. Set variable 'isStreaming' = true
2. Set variable 'streamingText' = "" (clear previous)
3. Call OpenAI API with stream:true, streaming variable bound to 'streamingText'
4. When API completes: Set 'isStreaming' = false
5. Push final message to messages array: { content: streamingText, role: 'assistant', timestamp: now() }

**Style - Messages Area:**
- fontFamily: string – Global font family. Example: 'Inter, sans-serif'
- messagesAreaBgColor: string – Messages area background. Example: '#ffffff'
- messagesAreaPadding: string – Messages area padding. Example: '16px'
- emptyMessageText: string – Text when no messages. Example: 'No messages yet'
- emptyMessageColor: string – Empty state color. Example: '#64748b'

**Style - Date Separators:**
- dateSeparatorTextColor: string – Date separator text color. Example: '#64748b'
- dateSeparatorLineColor: string – Date separator line color. Example: '#e2e8f0'
- dateSeparatorBgColor: string – Date separator background. Example: '#ffffff'
- dateSeparatorBorderRadius: string – Date separator border radius. Example: '8px'

**Style - Assistant Messages (ChatGPT-style):**
- messageBgColor: string – Assistant message background. Example: 'transparent' (default: no bubble)
- messageTextColor: string – Assistant message text. Example: '#334155'
- messageBorder: string – Assistant message border. Example: 'none' (default: no border)
- messageRadius: string – Assistant border radius. Example: '0px'
- messageFontSize: string – Assistant font size. Example: '0.875rem'
- messageFontWeight: string – Assistant font weight. Example: '400'
- messageFontFamily: string – Assistant font family. Example: 'inherit'
- messageShowTimestamp: boolean – Show timestamp for assistant messages. Example: true

**Style - User Messages (Bubble):**
- ownMessageBgColor: string – User message background. Example: '#f4f4f4'
- ownMessageTextColor: string – User message text. Example: '#1e1e1e'
- ownMessageBorder: string – User message border. Example: '1px solid #d0d0d0'
- ownMessageRadius: string – User border radius. Example: '18px'
- ownMessageFontSize: string – User font size. Example: '0.875rem'
- ownMessageFontWeight: string – User font weight. Example: '400'
- ownMessageFontFamily: string – User font family. Example: 'inherit'
- ownMessageShowTimestamp: boolean – Show timestamp for user messages. Example: true

**Style - Attachment Thumbnails:**
- messagesAttachmentThumbMaxWidth: string – Max width for attachment thumbnails. Example: '250px'
- messagesAttachmentThumbMaxHeight: string – Max height for attachment thumbnails. Example: '200px'
- messagesAttachmentThumbMinWidth: string – Min width for attachment thumbnails (fallback for SVGs without intrinsic dimensions). Example: '80px'
- messagesAttachmentThumbMinHeight: string – Min height for attachment thumbnails (fallback for SVGs without intrinsic dimensions). Example: '80px'
- messagesAttachmentThumbBorderRadius: string – Border radius for thumbnails. Example: '6px'

**Style - Input Area:**
- inputBgColor: string – Input area container bg. Example: '#ffffff'
- inputAreaBorder: string – Input area top border. Example: '1px solid #e2e8f0'
- textareaBorder: string – Textarea border. Example: '1px solid #e2e8f0'
- textareaBorderHover: string – Textarea hover border. Example: '1px solid #cbd5e1'
- textareaBorderFocus: string – Textarea focus border. Example: '1px solid #3b82f6'
- inputTextColor: string – Textarea text color. Example: '#334155'
- inputFontSize: string – Textarea font size. Example: '0.875rem'
- inputFontWeight: string – Textarea font weight. Example: '400'
- inputFontFamily: string – Textarea font family. Example: 'inherit'
- inputPlaceholderColor: string – Placeholder color. Example: '#94a3b8'
- inputHeight: string – Textarea height. Example: '38px'
- inputBorderRadius: string – Textarea radius. Example: '8px'
- inputPlaceholder: string – Placeholder text. Example: 'Message...'
- inputActionAlign: 'start'|'end' – Vertical alignment of send button. Example: 'end'

**Style - Send Button:**
- sendIcon: string – Send icon name. Example: 'send'
- sendIconColor: string – Send icon color. Example: '#334155'
- sendIconSize: string – Send icon size. Example: '20px'
- sendButtonBgColor: string – Send button bg/gradient. Example: 'linear-gradient(135deg, #3b82f6, #2563eb)'
- sendButtonHoverBgColor: string – Send button hover bg. Example: 'linear-gradient(135deg, #2563eb, #1d4ed8)'
- sendButtonBorder: string – Send button border. Example: 'none'
- sendButtonBorderRadius: string – Send button radius. Example: '12px'
- sendButtonSize: string – Send button size. Example: '42px'
- sendButtonBoxShadow: string – Send button shadow. Example: '0 2px 4px rgba(59,130,246,.3)'

**Style - Attachment Button:**
- attachmentIcon: string – Attachment icon name. Example: 'paperclip'
- attachmentIconColor: string – Attachment icon color. Example: '#334155'
- attachmentIconSize: string – Attachment icon size. Example: '20px'
- removeIcon: string – Remove attachment icon name. Example: 'x'
- removeIconColor: string – Remove icon color. Example: '#334155'
- removeIconSize: string – Remove icon size. Example: '16px'
- attachmentButtonBgColor: string – Attachment button bg. Example: '#f8fafc'
- attachmentButtonHoverBgColor: string – Attachment button hover. Example: '#f1f5f9'
- attachmentButtonBorder: string – Attachment button border. Example: '1px solid #e2e8f0'
- attachmentButtonBorderRadius: string – Attachment button radius. Example: '12px'
- attachmentButtonSize: string – Attachment button size. Example: '42px'
- attachmentButtonBoxShadow: string – Attachment button shadow. Example: '0 1px 2px rgba(0,0,0,.06)'

***Context data (only accessible to this element and its children):***
- context.local.data?.['chat']?.messages - Array of all messages with isOwn, isFirst, isLast properties
- context.local.data?.['chat']?.utils.messageCount - Total number of messages
- context.local.data?.['chat']?.utils.isDisabled - Whether chat is disabled

***Exposed Variables:***
- chatState: ***READ ONLY*** Contains messages array and utils object. (path: variables['current_element_uid-chatState'])
- pendingAttachments: Array of files awaiting upload. Each item contains: { id, name, type, size, url (blob), path, file }. Use to show attachment preview or count before sending. (path: variables['current_element_uid-pendingAttachments'])

***Events:***
- messageSent: Triggered when the user sends a message. Payload: { message: { id, content, role: 'user', timestamp, attachments?: File[] } }
- messageReceived: Triggered when a new assistant message is detected. Payload: { message: { id, content, role: 'assistant', timestamp, attachments? } }
- attachmentClick: Triggered when user clicks an attachment in a message. Payload: { attachment: { id, name, url, type, size, path } }
- pendingAttachmentClick: Triggered when user clicks a pending attachment before sending. Payload: { attachment: File, index }
- messageRightClick: Triggered when user right-clicks a message. Payload: { message, position: { elementX, elementY, viewportX, viewportY } }

***Exposed Element Actions:***
- scrollToBottom: (smooth?: boolean) Scroll to the latest message; uses `autoScrollBehavior` when arg omitted.
- addMessage: (message: { content, role, timestamp?, id?, ...rest }) Add a message programmatically to the chat. Accepts both 'content' and 'text' fields for backwards compatibility.

***Notes:***
- **Role-based system**: Messages use `role` property with values 'user' or 'assistant' (not participants)
- **ChatGPT-style by default**: Assistant messages have transparent background and no border; user messages have bubble style
- **File Type Restrictions**: Use `allowedAttachmentTypes` to restrict uploads (e.g., 'image/*' for images only, '.pdf' for PDFs, 'image/*,.pdf' for mixed). Rejected files show a customizable error message via `attachmentErrorMessage`.
- **Attachment Modes**: `attachmentMode` can be 'single' (replaces previous) or 'multiple' (allows multiple per message).
- **Localization**: Use `locale` to set language for date/time display. Customize text with `todayText`, `yesterdayText`, `justNowText`. Choose time format with `timeFormat`.
- **File Paths**: Use `mappingAttachmentPath` to extract file storage paths from messages (useful for Supabase, S3, or other cloud storage integrations).
- **Streaming support (CRITICAL)**:
  - **ALWAYS** bind both `isStreaming` AND `streamingText` properties when implementing AI chat
  - `isStreaming` controls whether a temporary streaming bubble appears (set to `true` during generation, `false` when done)
  - `streamingText` should be bound to the live streaming output variable (e.g., OpenAI plugin's streaming variable)
  - The component shows `streamingText` in a temporary assistant message bubble while `isStreaming=true`
  - When `isStreaming` becomes `false`, the streaming bubble disappears (you must then add the final message to `messages` array)
  - `streamingText` accepts both string and string[] (uses first element if array for OpenAI compatibility)
  - **DO NOT** manually add streaming message to `messages` array - component handles temporary display automatically
  - **DO** add the final complete message to `messages` array AFTER setting `isStreaming=false`
- **Message content field**: Uses `content` field (OpenAI API standard) instead of `text`. Backwards compatible via `addMessage` action
- **Attachments in events**: `messageSent` event includes attachments as File[] objects (not metadata), ready for base64 encoding with FileReader
- **Markdown rendering**: Enable `enableMarkdown` to render bold, italic, code blocks, links, lists, headers with syntax highlighting. When disabled, newlines (\n) are still respected via CSS
- **Attachments for AI**: Enable `allowAttachments` for vision models (ChatGPT Vision, Claude with vision) or document analysis
- **Date separators**: Automatically shown between messages from different days
- **Message right-click**: Use for custom context menus or message actions
- **All styles configurable**: Despite ChatGPT defaults, you can fully customize appearance via properties
- Enter sends message; Shift+Enter inserts newline
- Component includes built-in input area; do NOT add custom message input
- No header or participants system (simplified for AI chat use cases)

***Complete Workflow Example (with Streaming):***

Required Variables:
- messages (array) - Stores all chat messages
- isStreaming (boolean) - Controls streaming state
- streamingText (string) - Holds streaming content from API

On Chat messageSent event workflow:
1. Action: Add user message to 'messages' array
   - Push: { content: event.message.content, role: 'user', timestamp: now(), id: generateId() }
2. Action: Set 'isStreaming' = true
3. Action: Set 'streamingText' = "" (clear previous stream)
4. Action: Call OpenAI/Claude API with stream: true
   - Bind streaming output to 'streamingText' variable
   - This automatically updates the UI as tokens arrive
5. Action: When API completes, set 'isStreaming' = false
6. Action: Push final assistant message to 'messages' array
   - Push: { content: streamingText, role: 'assistant', timestamp: now(), id: generateId() }

CRITICAL: The component will show a temporary streaming bubble while isStreaming=true. Do NOT manually add the streaming message to the messages array during streaming - only add the final message after streaming completes.

***Example:***
<elements>
{"uid":"chat-1","tag":"ww-chat-ai","name":"Chat AI","props":{"default":{"messages":{"js":"return variables['messages-variable']"},"userLabel":"You","assistantLabel":"AI Assistant","enableMarkdown":true,"allowAttachments":true,"isStreaming":{"js":"return variables['is-streaming']"},"streamingText":{"js":"return variables['stream-text']"},"fontFamily":"Inter, sans-serif","messagesAreaBgColor":"#ffffff","messageBgColor":"transparent","messageTextColor":"#334155","ownMessageBgColor":"#f4f4f4","ownMessageTextColor":"#1e1e1e","inputPlaceholder":"Ask me anything...","autoScrollBehavior":"smooth"}},"styles":{"default":{"width":"100%","height":"600px","display":"flex"}}}
</elements>

Expected messages data structure: [{"content":"Hello","role":"user","timestamp":"2025-01-15T10:30:00Z"},{"content":"Hi there!","role":"assistant","timestamp":"2025-01-15T10:30:05Z","attachments":[{"id":"img-1","name":"chart.png","url":"https://example.com/chart.png","type":"image/png","size":245600}]}]
